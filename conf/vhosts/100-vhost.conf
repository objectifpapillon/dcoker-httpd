<VirtualHost *:80>

    VirtualDocumentRoot /usr/local/apache2/htdocs/vhosts/%-4
    UseCanonicalName Off

    # RewriteMap ProjectsAlias "txt:/usr/local/apache2/htdocs/projects-alias.conf"
    LogLevel debug rewrite:trace8

	
    <Directory />
        AllowOverride All
         Require all granted
    </Directory>
		
    <DirectoryMatch "/usr/local/apache2/htdocs/vhosts/.*">
        RewriteEngine On
        RewriteBase /
        RewriteOptions InheritBefore
		AllowOverride All		            
		Require all granted
        RewriteRule ^ - [E=PHP_FPM_HOST:php]
        RewriteCond %{ENV:CUSTOM_PHP_VERSION} 5
        RewriteRule ^ - [E=PHP_FPM_HOST:php5]
        # Pass to fpm
        RewriteCond %{REQUEST_FILENAME} -f
        RewriteRule ^/usr/local/apache2/htdocs/vhosts/([^\.]+\.php)$ fcgi://%{ENV:PHP_FPM_HOST}:9000%{ENV:PHP_FPM_PATH}/$1 [L,P]
    </DirectoryMatch>

    PassEnv APPLICATION_ENV
    PassEnv PHP_FPM_PATH
    SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1

    LimitInternalRecursion 2

</VirtualHost>

<VirtualHost *:80>
        ServerAdmin you@example.com
        ServerName portail.luc.op
		ServerAlias luc.op


        <Directory />
            AllowOverride All
            Require all granted
        </Directory>

        DocumentRoot "/usr/local/apache2/htdocs/portail"
        <Directory "/usr/local/apache2/htdocs/portail">
                Options Indexes FollowSymLinks
                AllowOverride All
                Require all granted
        </Directory>


    <FilesMatch \.php$>
        # 2.4.10+ can proxy to unix socket
        # SetHandler "proxy:unix:/var/run/php5-fpm.sock|fcgi://localhost/"

        # Else we can just use a tcp socket:
        SetHandler "proxy:fcgi://php:9000"
    </FilesMatch>

</VirtualHost>